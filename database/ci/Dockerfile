FROM usgswma/iow_test_db:postgis11-jre11

LABEL maintainer=gs-w_eto_eb_federal_employees@usgs.gov

ARG DEFAULT_PASSWORD=changeMe
ARG DEFAULT_DATABASE_NAME=wqp_db
ARG DEFAULT_DATABASE_ADDRESS=127.0.0.1
ARG DEFAULT_DB_OWNER_USERNAME=wqp_core

ARG CONTEXTS=external,ci,schemaLoad
ENV CONTEXTS="${CONTEXTS}"
ARG POSTGRES_PASSWORD="${DEFAULT_PASSWORD}"
ENV POSTGRES_PASSWORD="${POSTGRES_PASSWORD}"

ARG WQP_DATABASE_ADDRESS="${DEFAULT_DATABASE_ADDRESS}"
ENV WQP_DATABASE_ADDRESS="${WQP_DATABASE_ADDRESS}"
ARG WQP_DATABASE_NAME="${DEFAULT_DATABASE_NAME}"
ENV WQP_DATABASE_NAME="${WQP_DATABASE_NAME}"
ARG WQP_DB_OWNER_USERNAME="${DEFAULT_DB_OWNER_USERNAME}"
ENV WQP_DB_OWNER_USERNAME="${WQP_DB_OWNER_USERNAME}"
ARG WQP_DB_OWNER_PASSWORD="${DEFAULT_PASSWORD}"
ENV WQP_DB_OWNER_PASSWORD="${WQP_DB_OWNER_PASSWORD}"
ARG WQP_SCHEMA_NAME=wqp
ENV WQP_SCHEMA_NAME="${WQP_SCHEMA_NAME}"
ARG WQP_SCHEMA_OWNER_USERNAME=wqp_core
ENV WQP_SCHEMA_OWNER_USERNAME="${WQP_SCHEMA_OWNER_USERNAME}"
ARG WQP_SCHEMA_OWNER_PASSWORD="${DEFAULT_PASSWORD}"
ENV WQP_SCHEMA_OWNER_PASSWORD="${WQP_SCHEMA_OWNER_PASSWORD}"
ARG WQP_READ_ONLY_USERNAME=wqp_user
ENV WQP_READ_ONLY_USERNAME="${WQP_READ_ONLY_USERNAME}"
ARG WQP_READ_ONLY_PASSWORD="${DEFAULT_PASSWORD}"
ENV WQP_READ_ONLY_PASSWORD="${WQP_READ_ONLY_PASSWORD}"

############################################
# Grab files for initializing wqp database
############################################

ENV LIQUIBASE_WORKSPACE_WQP $LIQUIBASE_HOME/workspace/wqp
COPY ./liquibase/changeLogs $LIQUIBASE_WORKSPACE_WQP
COPY ./liquibase/scripts/*.sh /docker-entrypoint-initdb.d/
COPY ./liquibase/scripts/dbInit /docker-entrypoint-initdb.d/
